---
created: 2021-09-03T19:47:41 (UTC +03:00)
source: https://www.digitalocean.com/6/tutorials/how-to-create-a-calibre-ebook-server-on-ubuntu-20-04
author: Ivan Yastrebov
---

# Как создать сервер **d66**электронных книг калибра на Ubuntu 20.04 | DigitalOcean

---
_Автор выбрал [Фонд помощи COVID-19](https://www.brightfunds.org/funds/write-for-donations-covid-19-relief-fund) для получения пожертвования в рамках программы [Write for DOnations](https://do.co/w4do-cta) ._

### Вступление

[caliber - это бесплатный менеджер электронных книг с открытым исходным кодом](https://manual.calibre-ebook.com/) , хорошо известный своим кроссплатформенным настольным приложением. Вы можете использовать calibre для управления библиотекой электронных книг на одном устройстве, но приложение также включает мощный серверный компонент. Настройка сервера электронных книг позволяет:

+   Доступ к своим книгам из любой точки мира
+   Легко переносите свои книги на мобильные устройства
+   Делитесь книгами с друзьями и семьей

[Сервер содержимого calibre включает в себя бэкэнд для обслуживания ваших книг и базовый интерфейс для поиска в вашей библиотеке](https://manual.calibre-ebook.com/server.html) , загрузки отдельных заголовков или даже чтения ваших книг непосредственно через веб-браузер. Сервер также предлагает базовый мобильный интерфейс, который работает с широким спектром устройств, включая базовые браузеры, которые поставляются со многими устройствами чтения электронных чернил, такими как Kindle и Kobo.

В этом руководстве вы настроите и будете использовать сервер содержимого calibre в Ubuntu 20.04. В частности, вы загрузите и установите сервер calibre, сконфигурируете caliber как службу, чтобы она запускалась автоматически при перезагрузке сервера, и добавите книги в свою библиотеку с помощью инструментов командной строки. Вы также столкнетесь с вариантами настройки задания cron для автоматического добавления новых книг в вашу библиотеку из определенного каталога, добавления аутентификации на свой сервер, чтобы только вы могли получить к нему доступ, и добавления бесплатного сертификата SSL / TLS для обслуживания вашей библиотеки. HTTPS для дополнительной безопасности.

**Предупреждение.** Как и в случае со всем творческим контентом, важно соблюдать лицензии на авторские права, связанные с материалами, созданными другими. В этом руководстве используются общедоступные книги, законно загруженные из [Project Gutenberg](https://www.gutenberg.org/) , в котором содержится более 60 000 бесплатных электронных книг.  

## Предпосылки

+   Сервер под управлением Ubuntu 20.04 с пользователем sudo и брандмауэром. [Инструкции можно найти в нашем Руководстве по начальной установке сервера](https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04) .
+   Шаг 7 включает возможность защитить ваш сервер содержимого Caliber с помощью сертификата SSL. Если вы хотите это сделать, вам потребуется доменное имя с доступной записью A. Если вы используете [дроплет DigitalOcean](https://www.digitalocean.com/products/droplets/) , вы можете следовать нашему руководству по \[Как указать серверы имен DigitalOcean от общих регистраторов доменов\] (digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common -domain-registrars) для получения инструкций.

## Шаг 1 - Загрузка и установка сервера содержимого calibre

Хотя калибр существует в репозиториях программного обеспечения Ubuntu, его версия часто отстает от последней версии. Поэтому официальная документация по калибру рекомендует вместо этого установить его из двоичного файла, размещенного на их сайте.

Сначала установите необходимые зависимости:

```
sudo apt update && sudo apt install -y libfontconfig libgl1-mesa-glx
```

Теперь загрузите и установите сервер калибра.
```
wget https://download.calibre-ebook.com/linux-installer.sh
```

Осмотрите содержимое скрипта:

```
less linux-installer.sh
```

Вы можете прокручивать вверх и вниз с помощью `k`и `j`клавиш и нажмите , `q`чтобы вернуться к терминалу , когда вы закончите.

Теперь выполните скрипт для установки калибра:
```
sudo sh linux-installer.sh
```
calibre ожидает среду рабочего стола, но не найдет ее на автономном сервере, поэтому вы увидите несколько предупреждений о сбое интеграции рабочего стола. Их можно безопасно игнорировать, потому что мы будем полностью контролировать калибр через его инструменты командной строки и веб-интерфейс.

Теперь, когда мы установили калибр, мы можем приступить к изучению его функций.

## Шаг 2 - Создание библиотеки и добавление вашей первой книги

Чтобы изучить возможности калибра, загрузите электронную книгу `.epub`или `.mobi`книгу. В качестве примера мы воспользуемся _рождественской песней_ Чарльза Диккенса из [Project Gutenberg](https://www.gutenberg.org/) . Project Gutenberg поддерживает огромное хранилище бесплатной литературы в общественном достоянии и является отличным ресурсом для электронных книг.

Выполните следующую команду, чтобы загрузить эту книгу на свой сервер:
```
wget http://www.gutenberg.org/ebooks/46.kindle.noimages -O christmascarol.mobi
```
Теперь создайте каталог, который calibre может использовать в качестве библиотеки электронных книг:
```
mkdir calibre-library
```
И добавьте книгу, которую вы только что скачали, в свою новую библиотеку, используя `calibredb`команду:
```
calibredb add *.mobi --with-library calibre-library/
```

Вы увидите следующий результат:
```
OutputAdded book ids: 1
```

С книгой, добавленной в вашу библиотеку, теперь вы можете запустить калибр и изучить приложение.

## Шаг 3 - Запуск сервера содержимого calibre и просмотр вашей библиотеки

Установив калибр и скачав книгу, мы готовы исследовать пользовательский интерфейс приложения. Но прежде чем мы получим доступ к серверу содержимого calibre в веб-браузере, нам нужно убедиться, что наш сервер может принимать трафик через порт `8080`, который является портом по умолчанию для calibre. Если вы следовали руководству по начальной настройке сервера в разделе предварительных требований, значит, вы включили `ufw`, или [Несложный брандмауэр](https://wiki.ubuntu.com/UncomplicatedFirewall) . Теперь вам нужно разрешить порт `8080`через брандмауэр.

Используйте следующую команду, чтобы открыть порт `8080`: 
```
sudo ufw allow 8080
```

Проверьте статус, `ufw`чтобы убедиться, что порт открыт:
```
sudo ufw status
```

Вы увидите такой вывод:

```
OutputStatus: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
8080                       ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
8080 (v6)                  ALLOW       Anywhere (v6)
```

Теперь выполните следующую команду, чтобы запустить сервер содержимого калибра:
```
calibre-server calibre-library
```
`calibre-server`\- это команда, используемая для запуска нашего сервера, и `calibre-library`это имя каталога, который мы создали ранее и указали caliber для использования в качестве нашей библиотеки.

Вы увидите такой вывод:

```
calibre server listening on 0.0.0.0:8080
OPDS feeds advertised via BonJour at: your_server_ip port: 8080
```

На локальном компьютере зайдите `your_server_ip:8080`(подставив IP-адрес вашего сервера), и вы увидите экран калибра по умолчанию. Нажмите на **библиотеку калибра,** и вы увидите книгу, которую вы добавили на предыдущем шаге.

![меню сервера калибра](https://assets.digitalocean.com/articles/67462/calibre_1.png)

Нажмите, `Ctrl+C`чтобы остановить запущенный вручную серверный процесс.

Этот метод запуска сервера содержимого calibre работает хорошо, но вы, вероятно, хотите, чтобы ваша библиотека работала все время, даже после того, как вы закрыли SSH-соединение с вашим сервером. Чтобы он всегда работал, даже после перезагрузки сервера, давайте превратим сервер содержимого calibre в службу.

## Шаг 4 - Создание службы для сервера содержимого calibre

Чтобы повысить удобство использования сервера содержимого calibre, давайте заменим наш ручной процесс сервера на службу, которая запускается при загрузке.

Сначала создайте файл с именем `calibre-server.service`в каталоге `/etc/sytemd/system/`:

Теперь добавьте следующие конфигурации, которые запустят сервер содержимого calibre при загрузке. Не забудьте заменить выделенный текст вашим пользователем и группой:

калибр-server.service

Здесь мы говорим нашей службе использовать `--enable-local-write`флаг при запуске сервера. Когда сервер запущен, вы не можете использовать `calibredb`команду для добавления книг, как мы это делали непосредственно для _«Рождественской песни»_ . Вместо этого вы должны сделать это «через» работающий сервер, как мы увидим чуть позже, а это означает, что серверу необходимо разрешение на запись новых файлов на диск. Этот флаг позволяет ему делать это, пока он получает запрос локально.

Сохраните и закройте файл.

Теперь включите сервис и запустите его:

Перезагрузите сервер:

Подождите несколько минут, а затем снова зайдите в свой локальный веб-браузер, чтобы убедиться, что сервер содержимого calibre загрузился автоматически.`http://your_server_ip:8080`

Теперь давайте добавим аутентификацию в наше приложение.

## Шаг 5 - (Необязательно) Добавление аутентификации пользователя на сервер содержимого calibre

Теперь у вас есть полностью функционирующий сервер контента калибра, к которому вы можете получить доступ с любого устройства. Однако в настоящее время любой, кто знает IP-адрес вашего сервера, может получить доступ к вашим электронным книгам. Возможно, вы этого не захотите. Вместо этого давайте настроим встроенную систему управления пользователями calibre, чтобы вы могли заставить посетителей проходить аутентификацию с помощью имени пользователя и пароля.

Во-первых, вернитесь по SSH на свой сервер и остановите калибр. Это позволит нам напрямую управлять базой данных калибра:

Теперь запустите сценарий управления пользователями calibre:

При появлении запроса выберите добавление нового пользователя. Затем выберите имя пользователя и надежный пароль. Вы увидите окончательное выходное сообщение, подобное этому:

```
OutputUser mycalibreuser added successfully!
```

Теперь нам нужно внести одно небольшое изменение в наш сервис.

Открыть снова `calibre-server.service`:

Чтобы включить аутентификацию, добавьте `--enable-auth`флаг в конец начальной строки `ExecStart`. Должно получиться так:

Сохраните и закройте файл.

Обновите демон сервисов, чтобы повторно просканировать файлы сервисов, и снова запустите сервер calibre с помощью:

Если вы снова посетите свою библиотеку, она теперь должна запросить у вас имя пользователя и пароль, прежде чем вы сможете получить к ней доступ.

Есть и другие способы добавить функциональность к нашему серверу контента calibre. На следующем шаге мы добавим задание cron для автоматического добавления загруженных книг в нашу библиотеку calibre.

## Шаг 6 - (Необязательно) Автоматическое добавление книг в библиотеку вашего калибра

Может быть полезно настроить задание cron, которое отслеживает определенный каталог и добавляет любые найденные книги в вашу библиотеку calibre. Таким образом, вы можете загружать или выгружать книги в эту папку, и они автоматически становятся доступными через веб-интерфейс калибра.

Создайте папку с именем `books-to-add`в вашем домашнем каталоге и перейдите внутрь:

Загрузите новую книгу в этот каталог. Используйте следующую команду, чтобы загрузить _Алису в стране чудес_ из Project Gutenberg:

Теперь откройте ваш crontab:

Здесь мы настроим сценарий для добавления всех файлов в этом каталоге в calibre, а затем удалим их (добавление книг в caliber создает копию файлов в каталоге вашей библиотеки, поэтому мы можем удалить оригиналы после их добавления.)

Добавьте следующий контент:

/ var / spool / cron / crontabs / ваше\_имя\_пользователя

Сохраните и закройте файл.

Это будет выполняться каждые 5 минут, поэтому вам не придется долго ждать, пока ваша новая книга появится в веб-интерфейсе. Подождите несколько минут, а затем перезагрузите библиотеку в локальном веб-браузере. Ваша новая книга появится рядом с _«Рождественской песней»_ .

## Шаг 7. (Необязательно) Установка Apache2 и обслуживание вашей библиотеки через HTTPS

Вам нужны имя пользователя и пароль для доступа к вашей библиотеке, но это не совсем безопасно, потому что вы обслуживаете ее через HTTP и отправляете свое имя пользователя и пароль в незашифрованном виде при каждой аутентификации. Более безопасный вариант - обеспечить шифрование всего трафика с помощью HTTPS. Если у вас есть доменное имя, вы можете указать его на свой сервер и установить бесплатный SSL-сертификат с помощью Let's Encrypt. (Вы также можете использовать поддомен, например .)`ebooks.your_domain`

### Установка и настройка Apache2

Мы будем использовать [веб-сервер Apache2](https://httpd.apache.org/) в качестве обратного прокси для calibre. Раньше нам приходилось добавлять номер порта `:8080`при посещении нашей библиотеки, потому что это порт по умолчанию, на котором работает калибр. Теперь мы настроим Apache2 для прослушивания запросов через порт `80`( порт по умолчанию для HTTP-трафика), прокси-запросы к локально запущенному серверу calibre `:8080`и прозрачно обслуживать их конечному пользователю, чтобы им не нужно было беспокоиться о указав номер порта. Затем мы защитим весь наш трафик на порту `443`с помощью сертификата SSL.

Установите Apache2 и включите необходимые нам прокси-модули с помощью следующих команд:

Теперь убедитесь, что ваш сервер разрешает трафик на портах `80`и `443`. Закройте порт `8080`тоже:

Затем создайте и откройте файл по адресу :`/etc/apache2/sites-available/your_domain.conf`

Добавьте следующие конфигурации, которые свяжут ваш домен с сервером калибра:

/etc/apache2/sites-available/your\_domain.conf

Наконец, включите эту новую конфигурацию сайта:

Зайдите в браузер, чтобы убедиться, что сервер содержимого калибра загружается. Apache теперь обслуживает ваш сайт.`http://your_domain`

### Установка Certbot и настройка SSL-сертификата

В качестве последнего шага [давайте защитим весь наш трафик с помощью Certbot](https://certbot.eff.org/) .

Сначала установите Certbot:

Теперь запустите Certbot:

Программа Certbot предложит вам установить сертификат.

+   Введите свой адрес электронной почты, когда будет предложено
+   `A`При появлении запроса введите, чтобы принять условия использования.
+   Выберите `Y`или, `N`когда будет предложено поделиться своим адресом электронной почты с EFF
+   `1`При появлении запроса выберите, для какого домена вы хотите получить сертификат (должен быть только один).

По завершении вы увидите сообщение с поздравлением.

Теперь вы можете безопасно получить доступ к своей библиотеке по адресу .`https://yourdomain`

## Заключение

В этом руководстве вы настроите сервер электронных книг калибра. Вы превратили его в службу, чтобы она запускалась при загрузке вашего сервера, добавили задание cron для автоматического поиска и добавления новых книг в вашу библиотеку, а также настроили аутентификацию и сертификат SSL для ее защиты.

Чтобы расширить проект, вы можете добавить больше книг из своей личной библиотеки или из [Project Gutenberg](https://www.gutenberg.org/) , [Standard Ebooks](https://standardebooks.org/) или где-либо еще. Не забывайте всегда соблюдать все законы об авторском праве, связанные с вашей библиотекой содержимого.

`###### tags: [] by EasyQuest`